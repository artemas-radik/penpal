{"ast":null,"code":"var _jsxFileName = \"/Users/khoinguyen/Programming/page-semantic-search/src/components/Brainstorm/index.jsx\",\n  _s2 = $RefreshSig$();\nimport { useState, useEffect, useRef } from \"react\";\nimport BrainstormMessage from \"./BrainstormMessage\";\nimport BrainstormForm from \"./BrainstormForm\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Brainstorm = _ref => {\n  _s2();\n  var _s = $RefreshSig$();\n  let {\n    brainstormThreads,\n    setBrainstormThreads,\n    selectedBrainstormThread,\n    setSelectedBrainstormThread,\n    socket,\n    setShowCTASubscribed\n  } = _ref;\n  const [commandValue, setCommandValue] = useState(\"\");\n  const [formSubmitting, setFormSubmitting] = useState(false);\n  useEffect(() => {\n    if (socket === null) return;\n    socket.onmessage = e => {\n      const data = JSON.parse(e.data);\n      if (data[\"error\"] !== undefined) {\n        console.log(data[\"error\"]);\n        setShowCTASubscribed(true);\n        return;\n      }\n      if (data[\"output_text\"]) {\n        setBrainstormThreads(brainstormThreads.map(thread => {\n          if (thread.id === data[\"thread_id\"]) {\n            const lastCommand = thread.commands.slice(-1)[0];\n            lastCommand.output_text = lastCommand.output_text + data[\"output_text\"];\n          }\n          return thread;\n        }));\n      }\n      if (data[\"command\"]) {\n        setBrainstormThreads(brainstormThreads.map(thread => {\n          if (thread.id === selectedBrainstormThread) {\n            return {\n              ...thread,\n              commands: [...thread.commands, data]\n            };\n          }\n          return thread;\n        }));\n      }\n      if (data[\"status\"] === \"DONE\") {\n        setFormSubmitting(false);\n      }\n    };\n    return () => {\n      socket.onmessage = null;\n    };\n  }, [brainstormThreads, selectedBrainstormThread, socket]);\n  const sendCommand = e => {\n    e.preventDefault();\n    socket.send(JSON.stringify({\n      command: commandValue,\n      websocket_type: \"brainstorm\",\n      thread_id: selectedBrainstormThread\n    }));\n    setCommandValue(\"\");\n  };\n  const getThreadCommands = () => {\n    return brainstormThreads.find(thread => thread.id === selectedBrainstormThread).commands;\n  };\n  const AlwaysScrollToBottom = () => {\n    _s();\n    const elementRef = useRef();\n    useEffect(() => elementRef.current.scrollIntoView());\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: elementRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 10\n    }, this);\n  };\n  _s(AlwaysScrollToBottom, \"CKe/C9l/PZDcdMrjDfTWxieUegY=\");\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-full w-4/5 relative\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"overflow-y-scroll overflow-x-hidden h-screen mx-auto left-0 right-0 w-5/6\",\n      children: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [getThreadCommands().map((command, index, arr) => {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(BrainstormMessage, {\n              text: command.command,\n              writtenByDelilah: false,\n              isLast: false,\n              brainstormThreads: brainstormThreads,\n              setBrainstormThreads: setBrainstormThreads,\n              setSelectedBrainstormThread: setSelectedBrainstormThread,\n              setShowCTASubscribed: setShowCTASubscribed\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(BrainstormMessage, {\n              text: command.output_text,\n              writtenByDelilah: true,\n              isLast: arr.length - 1 === index,\n              brainstormThreads: brainstormThreads,\n              setBrainstormThreads: setBrainstormThreads,\n              setSelectedBrainstormThread: setSelectedBrainstormThread,\n              setShowCTASubscribed: setShowCTASubscribed\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 103,\n              columnNumber: 9\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 8\n          }, this);\n        }), /*#__PURE__*/_jsxDEV(AlwaysScrollToBottom, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(BrainstormForm, {\n      commandValue: commandValue,\n      setCommandValue: setCommandValue,\n      sendCommand: sendCommand,\n      formSubmitting: formSubmitting,\n      setFormSubmitting: setFormSubmitting\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 3\n  }, this);\n};\n_s2(Brainstorm, \"4OT9LOChyOiv78jf3E2mv0paVCs=\");\n_c = Brainstorm;\nexport default Brainstorm;\nvar _c;\n$RefreshReg$(_c, \"Brainstorm\");","map":{"version":3,"names":["useState","useEffect","useRef","BrainstormMessage","BrainstormForm","Brainstorm","brainstormThreads","setBrainstormThreads","selectedBrainstormThread","setSelectedBrainstormThread","socket","setShowCTASubscribed","commandValue","setCommandValue","formSubmitting","setFormSubmitting","onmessage","e","data","JSON","parse","undefined","console","log","map","thread","id","lastCommand","commands","slice","output_text","sendCommand","preventDefault","send","stringify","command","websocket_type","thread_id","getThreadCommands","find","AlwaysScrollToBottom","elementRef","current","scrollIntoView","index","arr","length"],"sources":["/Users/khoinguyen/Programming/page-semantic-search/src/components/Brainstorm/index.jsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\"\nimport BrainstormMessage from \"./BrainstormMessage\"\nimport BrainstormForm from \"./BrainstormForm\"\n\nconst Brainstorm = ({\n\tbrainstormThreads,\n\tsetBrainstormThreads,\n\tselectedBrainstormThread,\n\tsetSelectedBrainstormThread,\n\tsocket,\n\tsetShowCTASubscribed,\n}) => {\n\tconst [commandValue, setCommandValue] = useState(\"\")\n\tconst [formSubmitting, setFormSubmitting] = useState(false)\n\n\tuseEffect(() => {\n\t\tif (socket === null) return\n\n\t\tsocket.onmessage = (e) => {\n\t\t\tconst data = JSON.parse(e.data)\n\t\t\tif (data[\"error\"] !== undefined) {\n\t\t\t\tconsole.log(data[\"error\"])\n\t\t\t\tsetShowCTASubscribed(true)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif (data[\"output_text\"]) {\n\t\t\t\tsetBrainstormThreads(\n\t\t\t\t\tbrainstormThreads.map((thread) => {\n\t\t\t\t\t\tif (thread.id === data[\"thread_id\"]) {\n\t\t\t\t\t\t\tconst lastCommand = thread.commands.slice(-1)[0]\n\t\t\t\t\t\t\tlastCommand.output_text =\n\t\t\t\t\t\t\t\tlastCommand.output_text + data[\"output_text\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn thread\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t}\n\t\t\tif (data[\"command\"]) {\n\t\t\t\tsetBrainstormThreads(\n\t\t\t\t\tbrainstormThreads.map((thread) => {\n\t\t\t\t\t\tif (thread.id === selectedBrainstormThread) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...thread,\n\t\t\t\t\t\t\t\tcommands: [...thread.commands, data],\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn thread\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t}\n\n\t\t\tif (data[\"status\"] === \"DONE\") {\n\t\t\t\tsetFormSubmitting(false)\n\t\t\t}\n\t\t}\n\n\t\treturn () => {\n\t\t\tsocket.onmessage = null\n\t\t}\n\t}, [brainstormThreads, selectedBrainstormThread, socket])\n\n\tconst sendCommand = (e) => {\n\t\te.preventDefault()\n\t\tsocket.send(\n\t\t\tJSON.stringify({\n\t\t\t\tcommand: commandValue,\n\t\t\t\twebsocket_type: \"brainstorm\",\n\t\t\t\tthread_id: selectedBrainstormThread,\n\t\t\t})\n\t\t)\n\t\tsetCommandValue(\"\")\n\t}\n\n\tconst getThreadCommands = () => {\n\t\treturn brainstormThreads.find(\n\t\t\t(thread) => thread.id === selectedBrainstormThread\n\t\t).commands\n\t}\n\n\tconst AlwaysScrollToBottom = () => {\n\t\tconst elementRef = useRef()\n\t\tuseEffect(() => elementRef.current.scrollIntoView())\n\t\treturn <div ref={elementRef} />\n\t}\n\n\treturn (\n\t\t<div className='h-full w-4/5 relative'>\n\t\t\t<div className='overflow-y-scroll overflow-x-hidden h-screen mx-auto left-0 right-0 w-5/6'>\n\t\t\t\t<>\n\t\t\t\t\t{getThreadCommands().map((command, index, arr) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div key={index}>\n\t\t\t\t\t\t\t\t<BrainstormMessage\n\t\t\t\t\t\t\t\t\ttext={command.command}\n\t\t\t\t\t\t\t\t\twrittenByDelilah={false}\n\t\t\t\t\t\t\t\t\tisLast={false}\n\t\t\t\t\t\t\t\t\tbrainstormThreads={brainstormThreads}\n\t\t\t\t\t\t\t\t\tsetBrainstormThreads={setBrainstormThreads}\n\t\t\t\t\t\t\t\t\tsetSelectedBrainstormThread={setSelectedBrainstormThread}\n\t\t\t\t\t\t\t\t\tsetShowCTASubscribed={setShowCTASubscribed}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<BrainstormMessage\n\t\t\t\t\t\t\t\t\ttext={command.output_text}\n\t\t\t\t\t\t\t\t\twrittenByDelilah={true}\n\t\t\t\t\t\t\t\t\tisLast={arr.length - 1 === index}\n\t\t\t\t\t\t\t\t\tbrainstormThreads={brainstormThreads}\n\t\t\t\t\t\t\t\t\tsetBrainstormThreads={setBrainstormThreads}\n\t\t\t\t\t\t\t\t\tsetSelectedBrainstormThread={setSelectedBrainstormThread}\n\t\t\t\t\t\t\t\t\tsetShowCTASubscribed={setShowCTASubscribed}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t\t\t<AlwaysScrollToBottom />\n\t\t\t\t</>\n\t\t\t</div>\n\t\t\t<BrainstormForm\n\t\t\t\tcommandValue={commandValue}\n\t\t\t\tsetCommandValue={setCommandValue}\n\t\t\t\tsendCommand={sendCommand}\n\t\t\t\tformSubmitting={formSubmitting}\n\t\t\t\tsetFormSubmitting={setFormSubmitting}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n\nexport default Brainstorm\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}